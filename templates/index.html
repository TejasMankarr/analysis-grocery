<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask App</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .ribbon {
            position: relative;
            width: 100%;
            height: 0.5rem; /* Height of the ribbon */
            margin: 1rem 0; /* Spacing around the ribbon */
        }
        .ribbon.green {
            background-color: #28a745; /* Green color for localStorage */
        }
        .ribbon.yellow {
            background-color: #ffc107; /* Yellow color for DB */
        }
    </style>
    <script>
        // Function to update the table with localStorage data
        function updateTable() {
            const tableBody = document.getElementById('localStorageTableBody');
            tableBody.innerHTML = ''; // Clear existing rows
            const tempData = JSON.parse(localStorage.getItem('tempData')) || [];

            tempData.forEach((data) => {
                // Create a new row for each item in localStorage
                const newRow = document.createElement('tr');
                newRow.innerHTML = `<td>${data.item}</td><td>${data.units}</td><td>${data.price}</td><td>${data.date}</td>`;
                tableBody.appendChild(newRow);
            });
        }

        function tempSend() {
            const item = document.getElementById('itemInput').value.trim();
            const units = document.getElementById('unitsInput').value.trim();
            const price = document.getElementById('priceInput').value.trim();
            const date = document.getElementById('dateInput').value.trim();

            // Validate inputs
            if (!item || !units || !price || !date) {
                showAlert("All fields must be filled.", "danger");
                return; // Exit if any field is empty
            }

            // Get existing data from localStorage, or initialize an empty array
            const tempData = JSON.parse(localStorage.getItem('tempData')) || [];
            tempData.push({ item, units, price, date }); // Add new data
            localStorage.setItem('tempData', JSON.stringify(tempData)); // Store updated data

            showAlert("Data stored in localStorage.", "success");
            updateTable(); // Update the table to reflect new data

            // Clear the input fields after storing data
            document.getElementById('itemInput').value = '';
            document.getElementById('unitsInput').value = '';
            document.getElementById('priceInput').value = '';
            // document.getElementById('dateInput').value = '';
        }

        function dbSend() {
            const tempData = JSON.parse(localStorage.getItem('tempData')) || [];
            if (tempData.length === 0) {
                showAlert("No data in localStorage to send.", "danger");
                return;
            }

            fetch('/send_to_db', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ data: tempData })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    showAlert("Data stored in the database successfully.", "success");
                    localStorage.removeItem('tempData'); // Clear localStorage
                    updateTable(); // Update the table to reflect data removal
                } else {
                    showAlert("Error: " + data.message, "danger");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                showAlert("An error occurred: " + error.message, "danger");
            });
        }

        function showAlert(message, type) {
            const alertBox = document.createElement('div');
            alertBox.className = `alert alert-${type} alert-dismissible fade show`;
            alertBox.role = 'alert';
            alertBox.innerHTML = message + 
                '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                '<span aria-hidden="true">&times;</span></button>';
            document.getElementById('alertContainer').appendChild(alertBox);
            setTimeout(() => {
                $(alertBox).alert('close');
            }, 3000); // Auto-close after 3 seconds
        }

        // Initial call to update the table on page load
        document.addEventListener('DOMContentLoaded', (event) => {
            updateTable();
        });
        function clearLocalStorageAndRefresh() {
  localStorage.clear();
  location.reload();
}
    </script>
</head>
<body><button onclick="clearLocalStorageAndRefresh()">Clear Local Storage and Refresh</button>
    <div class="container mt-5">
        <h1>Flask App</h1>
        <div id="alertContainer"></div>
        <div class="form-group">
            <div class="form-row">
                <div class="col">
                    <input type="text" class="form-control" id="itemInput" placeholder="Enter item" />
                </div>
                <div class="col">
                    <input type="text" class="form-control" id="unitsInput" placeholder="Enter units" />
                </div>
                <div class="col">
                    <input type="text" class="form-control" id="priceInput" placeholder="Enter price" />
                </div>
                <div class="col">
                    <input type="date" class="form-control" id="dateInput" placeholder="Enter date" />
                </div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="tempSend()">temp_send</button>
        <button class="btn btn-success" onclick="dbSend()">db_send</button>

        <h3 class="mt-4">Stored Data in LocalStorage</h3>
        <table class="table table-bordered mt-2">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Units</th>
                    <th>Price</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="localStorageTableBody">
                <!-- Local storage data will be displayed here -->
            </tbody>
        </table>
    </div>
    
    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
